#!/usr/bin/env bash
set -euo pipefail

ROOT_DIR="$(cd "$(dirname "$0")/.." && pwd)"
cd "$ROOT_DIR"

source "./scripts/_lib.sh"

run_check() {
  echo "Building Web..."
  if [[ -f "apps/web/package.json" ]]; then
     # Check if pnpm is installed, else use npm or skip. Assuming pnpm logic is separate.
     # For demo verification speed and deterministic env, we might want to skip heavy build if no node_modules
     if [[ -d "apps/web/node_modules" ]]; then
       (cd apps/web && pnpm build)
     else
       echo "SKIP: apps/web/node_modules not found. Skipping build."
     fi
  fi
  
  echo "Building Server..."
  if [[ -f "apps/server/pom.xml" ]]; then
      # Need verify mvn is available or use mvnw
      if command -v mvn &> /dev/null; then
          (cd apps/server && mvn package -DskipTests)
      else
          echo "SKIP: mvn not found"
      fi
  fi
}

ai_team_run_logged "build" run_check
